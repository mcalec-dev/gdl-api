document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("searchInput"),n=document.getElementById("searchButton"),t=document.getElementById("loading"),s=document.getElementById("results"),l=document.getElementById("noResults"),a=document.getElementById("searchInfo");async function o(e){if(e.length<3)return s.style.display="none",a.style.display="none",l.style.display="block",void(l.textContent="Please enter at least 3 characters");t.style.display="block",s.style.display="none",a.style.display="none",l.style.display="none",s.innerHTML="";try{const n=new URL(window.location);n.searchParams.set("q",e),window.history.pushState({},"",n);const o=await fetch(`/gdl/api/search?q=${encodeURIComponent(e)}`),i=await o.json();if(t.style.display="none",i.results?.length>0){a.style.display="block",a.textContent=`Found ${i.count} results for "${i.query}"`,s.style.display="grid";const e=document.createDocumentFragment();i.results.forEach((n=>{const t=document.createElement("div");t.className="result-card",t.innerHTML=`\n                        <div class="image-container">\n                            <img src="${n.url}?x=50" \n                                alt="${n.name}" \n                                class="thumbnail loading" \n                                loading="lazy"\n                            >\n                        </div>\n                        <div class="info-container">\n                            <h3>${n.name}</h3>\n                            <p class="type">Type: ${n.type}</p>\n                            <p class="collection">Collection: ${n.collection}</p>\n                            <a href="${n.url}" class="view-link" target="_blank">View ${n.type}</a>\n                        </div>\n                    `,e.appendChild(t)})),s.appendChild(e);const n=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=e.target;t.classList.contains("loading")&&(t.addEventListener("load",(()=>{t.classList.remove("loading")})),n.unobserve(t))}}))}),{rootMargin:"50px 0px",threshold:.1});document.querySelectorAll(".thumbnail.loading").forEach((e=>{n.observe(e)}))}else a.style.display="none",l.style.display="block",l.textContent="No results found"}catch{t.style.display="none",a.style.display="none",l.style.display="block",l.textContent="Search failed. Please try again."}}n.addEventListener("click",(()=>{const n=e.value.trim();n&&o(n)})),e.addEventListener("keypress",(n=>{if("Enter"===n.key){const n=e.value.trim();n&&o(n)}}));const i=new URLSearchParams(window.location.search).get("q");i&&(e.value=i,o(i))}));