const loadImageBtn=document.getElementById("loadImageBtn"),backImageBtn=document.getElementById("backImageBtn"),forwardImageBtn=document.getElementById("forwardImageBtn"),imageContainer=document.getElementById("imageContainer"),loading=document.getElementById("loading"),imageInfo=document.getElementById("imageInfo"),API_URL="/gdl/api/random",HISTORY_KEY="randomMediaHistory",HISTORY_LIMIT=10;let history=[],historyIndex=-1;function loadHistory(){const e=JSON.parse(localStorage.getItem(HISTORY_KEY));Array.isArray(e)&&(history=e,historyIndex=history.length-1)}function saveHistory(){localStorage.setItem(HISTORY_KEY,JSON.stringify(history))}function showMedia(e){imageContainer.classList.remove("has-image"),loading.textContent="Loading...",loading.style.display="block",loading.classList.remove("error"),imageContainer.querySelectorAll("img, video").forEach((e=>e.remove()));const o=e.url,t=e.file.toLowerCase().match(/\.(mp4|webm|mov)$/),a=t?document.createElement("video"):document.createElement("img");a.className="media-element",t&&(a.controls=!0,a.muted=!1,a.loop=!0,a.autoplay=!1),imageInfo.innerHTML=`\n    <span id="image-author">${e.author}</span><span> on </span><span id="image-collection" style="text-transform:capitalize;">${e.collection}</span><br>\n    <span id="image-size">${function(e){const o=["B","KB","MB","GB"];let t=e,a=0;for(;t>=1024&&a<o.length-1;)t/=1024,a++;return`${Math.round(100*t/100)} ${o[a]}`}(e.size)}</span>\n  `;a.addEventListener(t?"loadeddata":"load",(()=>{loading.style.display="none",a.style.display="block",imageInfo.style.display="block",imageContainer.classList.add("has-image")})),a.addEventListener("error",handleMediaError),a.src=o+"",imageContainer.appendChild(a),imageContainer.onclick=()=>window.open(o,"_blank")}async function loadRandomMedia(){try{imageContainer.classList.remove("has-image"),loading.textContent="<span>loading...</span>",loading.style.display="block",loading.classList.remove("error"),imageContainer.querySelectorAll("img, video").forEach((e=>e.remove()));const e=await fetch(API_URL);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const o=await e.json();-1!==historyIndex&&history[historyIndex]&&history[historyIndex].url===o.url||(historyIndex<history.length-1&&(history=history.slice(0,historyIndex+1)),history.push(o),history.length>10&&history.shift(),historyIndex=history.length-1,saveHistory()),showMedia(o)}catch(e){debug("Error loading random media:",e),handleMediaError()}}function handleMediaError(){loading.textContent="Failed to load media. Try again.",loading.classList.add("error"),imageInfo.style.display="none",imageContainer.classList.remove("has-image")}function showPreviousMedia(){historyIndex>0&&(historyIndex--,saveHistory(),showMedia(history[historyIndex],!0))}function showNextMedia(){historyIndex<history.length-1&&(historyIndex++,saveHistory(),showMedia(history[historyIndex],!0))}loadHistory(),loadImageBtn.addEventListener("click",loadRandomMedia),backImageBtn.addEventListener("click",showPreviousMedia),forwardImageBtn.addEventListener("click",showNextMedia);